---
import Layout from "../../../layouts/Layout.astro";
import Card from "../../../components/Card.astro";
import Input from "../../../components/Input.astro";
import Button from "../../../components/Button.astro";

const title = "Compound interest calculator (UK) — All The Calculators";
const description =
  "Estimate how your money could grow with compound interest using monthly or yearly compounding.";
---

<Layout title={title} description={description}>
  <div class="space-y-6">
    <header>
      <h1 class="text-2xl font-semibold tracking-tight">Compound interest</h1>
      <p class="mt-2 text-sm text-[rgb(var(--muted))] max-w-2xl">
        Estimate how your money could grow with compound interest. Compare monthly vs yearly compounding while adding a
        fixed monthly contribution.
      </p>
    </header>

    <section class="inputs-container space-y-4" aria-label="Compound interest inputs">
      <div class="inputs-grid">
        <div>
          <Input
            id="start"
            label="Starting balance (£)"
            type="number"
            inputmode="decimal"
            min="0"
            step="0.01"
            placeholder="e.g. 2,000"
          />
          <p id="start-error" class="mt-1 hidden text-xs text-red-600"></p>
        </div>

        <div>
          <Input
            id="monthly"
            label="Monthly contribution (£)"
            type="number"
            inputmode="decimal"
            min="0"
            step="0.01"
            placeholder="e.g. 200"
          />
          <p id="monthly-error" class="mt-1 hidden text-xs text-red-600"></p>
        </div>

        <div>
          <Input
            id="rate"
            label="Interest rate (%)"
            type="number"
            inputmode="decimal"
            min="0"
            step="0.01"
            placeholder="e.g. 4.0"
          />
          <p id="rate-error" class="mt-1 hidden text-xs text-red-600"></p>
        </div>

        <div>
          <Input
            id="years"
            label="Time period (years)"
            type="number"
            inputmode="numeric"
            min="1"
            step="1"
            placeholder="e.g. 5"
          />
          <p id="years-error" class="mt-1 hidden text-xs text-red-600"></p>
        </div>

        <div class="md:col-span-2">
          <div class="mb-1 text-sm font-medium text-[rgb(var(--text))]">Compounding frequency</div>
          <select
            id="frequency"
            class="w-full rounded-xl border border-[rgb(var(--border))] bg-white px-3 py-2 text-sm text-[rgb(var(--text))] focus:outline-none focus:ring-2 focus:ring-black/10"
          >
            <option value="monthly" selected>Monthly</option>
            <option value="yearly">Yearly</option>
          </select>
          <p id="frequency-error" class="mt-1 hidden text-xs text-red-600"></p>
        </div>
      </div>

      <div class="flex flex-wrap gap-3 pt-1">
        <Button type="button" id="calcBtn">Calculate</Button>
        <Button type="button" variant="ghost" id="resetBtn">Reset</Button>
      </div>

      <p class="text-xs text-[rgb(var(--muted))]">
        Assumes fixed monthly contributions and a fixed annual interest rate.
      </p>
    </section>

    <hr class="border-t border-[rgb(var(--border))]" />

    <section aria-label="Compound interest results" class="space-y-4">
      <header>
        <h2 class="text-[18px] font-semibold tracking-tight">Results</h2>
        <p class="mt-1 text-[14px] text-[rgb(var(--muted))]">
          These are estimates based on your inputs.
        </p>
      </header>

      <div class="results-grid" role="status" aria-live="polite" aria-atomic="true">
        <Card>
          <div class="text-xs font-medium uppercase tracking-wide text-[rgb(var(--muted))]">Final balance</div>
          <div class="mt-1 text-[18px] font-semibold tracking-tight" id="final">—</div>
          <div class="mt-1 text-xs text-[rgb(var(--muted))]">
            Estimated balance after the time period
          </div>
        </Card>

        <Card>
          <div class="text-xs font-medium uppercase tracking-wide text-[rgb(var(--muted))]">Total contributed</div>
          <div class="mt-1 text-[18px] font-semibold tracking-tight" id="contrib">—</div>
          <div class="mt-1 text-xs text-[rgb(var(--muted))]">
            Starting balance + contributions
          </div>
        </Card>

        <Card>
          <div class="text-xs font-medium uppercase tracking-wide text-[rgb(var(--muted))]">Interest earned</div>
          <div class="mt-1 text-[18px] font-semibold tracking-tight" id="interest">—</div>
          <div class="mt-1 text-xs text-[rgb(var(--muted))]">
            Growth from compounding
          </div>
        </Card>
      </div>
    </section>

    <hr class="border-t border-[rgb(var(--border))]" />

    <section class="max-w-2xl" aria-label="How this calculator works">
      <details class="group">
        <summary
          class="flex cursor-pointer list-none items-center gap-2 py-2 text-sm font-semibold tracking-tight focus:outline-none focus-visible:ring-2 focus-visible:ring-black/20 rounded-lg"
        >
          <span
            class="inline-flex h-4 w-4 items-center justify-center text-[rgb(var(--muted))] transition-transform group-open:rotate-90"
            aria-hidden="true"
          >
            <svg viewBox="0 0 20 20" width="16" height="16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M7.25 4.75L12.75 10L7.25 15.25"
                stroke="currentColor"
                stroke-width="1.75"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
          </span>
          <span>How this calculator works</span>
        </summary>

        <div class="pt-2 pl-6 space-y-2 text-sm text-[rgb(var(--muted))]">
          <p>
            We apply your contribution each month, then add interest either monthly or yearly depending on the selected
            compounding frequency. Monthly compounding applies a smaller rate each month, while yearly compounding adds
            interest once per year.
          </p>
          <p>
            This is a simplified model for planning. Real savings accounts may compound daily and apply interest monthly.
          </p>
        </div>
      </details>
    </section>

    <section class="max-w-2xl space-y-6" aria-label="Compound interest guide">
      <div>
        <h2 class="text-[18px] font-semibold tracking-tight">What this calculator does</h2>
        <p class="mt-2 text-sm text-[rgb(var(--muted))]">
          This compound interest calculator estimates how your money could grow over time when interest is reinvested.
          It includes monthly contributions so you can see the combined effect of saving regularly and compounding.
        </p>
        <p class="mt-2 text-sm text-[rgb(var(--muted))]">
          You can compare monthly vs yearly compounding to understand how frequency affects the final balance.
        </p>
      </div>

      <div>
        <h2 class="text-[18px] font-semibold tracking-tight">How the formula works</h2>
        <p class="mt-2 text-sm text-[rgb(var(--muted))]">
          Each month, we add your contribution to the balance. If you choose monthly compounding, we apply a monthly
          interest rate derived from the annual rate. If you choose yearly compounding, we apply the annual rate once
          every 12 months.
        </p>
        <p class="mt-2 text-sm text-[rgb(var(--muted))]">
          The calculator then compares the final balance to your total contributions to show how much growth comes from
          interest.
        </p>
      </div>

      <div>
        <h2 class="text-[18px] font-semibold tracking-tight">Worked example</h2>
        <p class="mt-2 text-sm text-[rgb(var(--muted))]">
          Example: start with £2,000, add £200 per month, earn 4% interest for 5 years. With monthly compounding, the
          final balance is roughly £16,500. With yearly compounding, it will be slightly lower.
        </p>
        <p class="mt-2 text-sm text-[rgb(var(--muted))]">
          The difference is the extra interest earned when interest is applied more frequently.
        </p>
      </div>

      <div>
        <h2 class="text-[18px] font-semibold tracking-tight">Common mistakes</h2>
        <ul class="mt-2 list-disc pl-5 text-sm text-[rgb(var(--muted))] space-y-1">
          <li>Assuming the interest rate never changes.</li>
          <li>Forgetting to include regular contributions.</li>
          <li>Confusing monthly compounding with monthly contributions.</li>
          <li>Expecting the result to match a specific account exactly.</li>
        </ul>
      </div>

      <div>
        <h2 class="text-[18px] font-semibold tracking-tight">When to use this calculator</h2>
        <p class="mt-2 text-sm text-[rgb(var(--muted))]">
          Use this when planning savings or investments over time. If you have a fixed goal and want to calculate the
          monthly amount needed, use the Savings goal calculator.
        </p>
      </div>

      <div>
        <h2 class="text-[18px] font-semibold tracking-tight">FAQs</h2>
        <div class="mt-2 space-y-3 text-sm text-[rgb(var(--muted))]">
          <div>
            <h3 class="font-semibold text-[rgb(var(--text))]">Is this the same as AER?</h3>
            <p class="mt-1">
              AER is a way to express annual interest including compounding. This calculator uses the rate you enter as
              the annual rate for calculations.
            </p>
          </div>
          <div>
            <h3 class="font-semibold text-[rgb(var(--text))]">What if I make irregular contributions?</h3>
            <p class="mt-1">
              The calculator assumes a fixed monthly amount. Irregular contributions will change the outcome.
            </p>
          </div>
          <div>
            <h3 class="font-semibold text-[rgb(var(--text))]">Why is monthly compounding higher?</h3>
            <p class="mt-1">
              Interest is applied more frequently, so you earn interest on interest sooner.
            </p>
          </div>
        </div>
      </div>

      <div>
        <h2 class="text-[18px] font-semibold tracking-tight">Related calculators</h2>
        <ul class="mt-2 list-disc pl-5 text-sm text-[rgb(var(--muted))] space-y-1">
          <li><a class="underline" href="/calculators/savings-growth">Savings growth calculator</a></li>
          <li><a class="underline" href="/calculators/savings-goal">Savings goal calculator</a></li>
          <li><a class="underline" href="/calculators/percentage-calculator">Percentage calculator</a></li>
        </ul>
      </div>
    </section>
  </div>

  <script is:inline>
    const fmtGBP2 = new Intl.NumberFormat("en-GB", { style: "currency", currency: "GBP" });

    const fields = {
      start: document.getElementById("start"),
      monthly: document.getElementById("monthly"),
      rate: document.getElementById("rate"),
      years: document.getElementById("years"),
      frequency: document.getElementById("frequency"),
    };

    const errors = {
      start: document.getElementById("start-error"),
      monthly: document.getElementById("monthly-error"),
      rate: document.getElementById("rate-error"),
      years: document.getElementById("years-error"),
      frequency: document.getElementById("frequency-error"),
    };

    function setBlankResults() {
      document.getElementById("final").textContent = "—";
      document.getElementById("contrib").textContent = "—";
      document.getElementById("interest").textContent = "—";
    }

    function showError(key, msg) {
      const input = fields[key];
      const err = errors[key];
      if (!input || !err) return;
      input.setAttribute("aria-invalid", "true");
      input.setAttribute("aria-describedby", `${key}-error`);
      input.classList.add("border-red-500");
      err.textContent = msg;
      err.classList.remove("hidden");
    }

    function clearError(key) {
      const input = fields[key];
      const err = errors[key];
      if (!input || !err) return;
      input.removeAttribute("aria-invalid");
      if (input.getAttribute("aria-describedby") === `${key}-error`) input.removeAttribute("aria-describedby");
      input.classList.remove("border-red-500");
      err.textContent = "";
      err.classList.add("hidden");
    }

    function parseNumber(el) {
      const v = String(el?.value ?? "").trim();
      if (v === "") return null;
      const n = Number(v);
      return Number.isFinite(n) ? n : null;
    }

    function validate() {
      ["start","monthly","rate","years","frequency"].forEach(clearError);
      let firstInvalid = null;

      const start = parseNumber(fields.start) ?? 0;
      const monthly = parseNumber(fields.monthly) ?? 0;
      const rate = parseNumber(fields.rate);
      const years = parseNumber(fields.years);
      const frequency = fields.frequency?.value ?? "monthly";

      if (start < 0) {
        showError("start", "Enter a starting balance of 0 or more.");
        firstInvalid ??= fields.start;
      }
      if (monthly < 0) {
        showError("monthly", "Enter a monthly contribution of 0 or more.");
        firstInvalid ??= fields.monthly;
      }
      if (rate === null || rate < 0 || rate > 200) {
        showError("rate", "Enter an interest rate between 0 and 200%.");
        firstInvalid ??= fields.rate;
      }
      if (years === null || years <= 0 || !Number.isInteger(years)) {
        showError("years", "Enter a time period in whole years (at least 1).");
        firstInvalid ??= fields.years;
      }
      if (start === 0 && monthly === 0) {
        showError("start", "Enter a starting balance or a monthly contribution.");
        firstInvalid ??= fields.start;
      }

      return { valid: !firstInvalid, firstInvalid, start, monthly, rate, years, frequency };
    }

    function calculate() {
      const v = validate();
      if (!v.valid) {
        setBlankResults();
        v.firstInvalid?.focus();
        return;
      }

      const months = v.years * 12;
      const annualRate = v.rate / 100;
      const monthlyRate = annualRate / 12;

      let balance = v.start;

      for (let i = 1; i <= months; i += 1) {
        balance += v.monthly;
        if (v.frequency === "monthly") {
          balance *= 1 + monthlyRate;
        } else if (i % 12 === 0) {
          balance *= 1 + annualRate;
        }
      }

      const contributed = v.start + v.monthly * months;
      const interest = balance - contributed;

      document.getElementById("final").textContent = fmtGBP2.format(balance);
      document.getElementById("contrib").textContent = fmtGBP2.format(contributed);
      document.getElementById("interest").textContent = fmtGBP2.format(interest);
    }

    function reset() {
      ["start","monthly","rate","years"].forEach((k) => {
        fields[k].value = "";
        clearError(k);
      });
      if (fields.frequency) fields.frequency.value = "monthly";
      setBlankResults();
      fields.start?.focus();
    }

    ["start","monthly","rate","years"].forEach((k) => fields[k]?.addEventListener("input", () => clearError(k)));

    const calcBtn = document.getElementById("calcBtn");
    const calcLabel = calcBtn?.querySelector("[data-calc-label]");
    const calcSpinner = calcBtn?.querySelector("[data-calc-spinner]");

    function setLoading(isLoading) {
      if (!calcBtn) return;
      calcBtn.disabled = isLoading;
      calcBtn.setAttribute("aria-busy", isLoading ? "true" : "false");
      calcBtn.classList.toggle("opacity-70", isLoading);
      calcBtn.classList.toggle("cursor-not-allowed", isLoading);
      calcSpinner?.classList.toggle("hidden", !isLoading);
      calcLabel?.classList.toggle("sr-only", isLoading);
    }

    calcBtn?.addEventListener("click", () => {
      if (calcBtn.disabled) return;
      setLoading(true);
      window.setTimeout(() => {
        calculate();
        setLoading(false);
      }, 1000);
    });
    document.getElementById("resetBtn")?.addEventListener("click", reset);

    setBlankResults();
  </script>
</Layout>
