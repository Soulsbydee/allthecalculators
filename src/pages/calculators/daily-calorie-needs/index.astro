---
import Layout from "../../../layouts/Layout.astro";
import Card from "../../../components/Card.astro";
import Input from "../../../components/Input.astro";
import Button from "../../../components/Button.astro";

const title = "Daily calorie needs calculator (UK) — All The Calculators";
const description =
  "Estimate daily calories to maintain your current weight based on age, height, weight, sex and activity level.";
---

<Layout title={title} description={description}>
  <div class="space-y-6">
    <div>
      <h1 class="text-2xl font-semibold tracking-tight">Daily calorie needs</h1>
      <p class="mt-2 text-sm text-[rgb(var(--muted))]">
        Estimate your daily calorie needs to maintain your current weight, based on your details and activity level.
        This is a general estimate and individual needs vary.
      </p>
    </div>

    <!-- Inputs (no bounding card) -->
    <section class="inputs-container space-y-4" aria-label="Daily calorie needs inputs">
      <div class="inputs-grid">
        <div>
          <Input
            id="age"
            label="Age (years)"
            type="number"
            inputmode="numeric"
            min="0"
            step="1"
            placeholder="e.g. 34"
          />
          <p id="age-error" class="mt-1 hidden text-xs text-red-600"></p>
        </div>

        <div>
          <div class="mb-1 text-sm font-medium text-[rgb(var(--text))]">Sex</div>
          <select
            id="sex"
            class="w-full rounded-xl border border-[rgb(var(--border))] bg-white px-3 py-2 text-sm text-[rgb(var(--text))] focus:outline-none focus:ring-2 focus:ring-black/10"
          >
            <option value="">Select…</option>
            <option value="male">Male</option>
            <option value="female">Female</option>
          </select>
          <p id="sex-error" class="mt-1 hidden text-xs text-red-600"></p>
        </div>

        <div>
          <Input
            id="height"
            label="Height (cm)"
            type="number"
            inputmode="numeric"
            min="0"
            step="1"
            placeholder="e.g. 175"
          />
          <p id="height-error" class="mt-1 hidden text-xs text-red-600"></p>
        </div>

        <div>
          <Input
            id="weight"
            label="Weight (kg)"
            type="number"
            inputmode="decimal"
            min="0"
            step="0.1"
            placeholder="e.g. 72"
          />
          <p id="weight-error" class="mt-1 hidden text-xs text-red-600"></p>
        </div>

        <div class="md:col-span-2">
          <div class="mb-1 text-sm font-medium text-[rgb(var(--text))]">Activity level</div>
          <select
            id="activity"
            class="w-full rounded-xl border border-[rgb(var(--border))] bg-white px-3 py-2 text-sm text-[rgb(var(--text))] focus:outline-none focus:ring-2 focus:ring-black/10"
          >
            <option value="">Select…</option>
            <option value="sedentary">Sedentary — Little or no exercise</option>
            <option value="light">Lightly active — Light exercise 1–3 days per week</option>
            <option value="moderate">Moderately active — Moderate exercise 3–5 days per week</option>
            <option value="very">Very active — Hard exercise 6–7 days per week</option>
          </select>
          <p id="activity-error" class="mt-1 hidden text-xs text-red-600"></p>
        </div>
      </div>

      <div class="flex flex-wrap gap-3 pt-1">
        <Button type="button" id="calcBtn">Calculate</Button>
        <Button type="button" variant="ghost" id="resetBtn">Reset</Button>
      </div>

      <p class="text-xs text-[rgb(var(--muted))]">
        We estimate BMR (basal metabolic rate) and apply an activity multiplier to estimate maintenance calories.
      </p>
    </section>

    <!-- Divider -->
    <hr class="border-t border-[rgb(var(--border))]" />

    <!-- Results (NO tinted wrapper) -->
    <section aria-label="Daily calorie needs results" class="space-y-4">
      <header>
        <h2 class="text-[18px] font-semibold tracking-tight">Results</h2>
        <p class="mt-1 text-[14px] text-[rgb(var(--muted))]">
          These are estimates based on your inputs.
        </p>
      </header>

      <div class="results-grid" role="status" aria-live="polite" aria-atomic="true">
        <Card>
          <div class="text-xs font-medium uppercase tracking-wide text-[rgb(var(--muted))]">
            Daily calories (maintenance)
          </div>
          <div class="mt-1 text-[18px] font-semibold tracking-tight" id="tdee">—</div>
          <div class="mt-1 text-xs text-[rgb(var(--muted))]">
            Estimated calories per day to maintain your current weight at your activity level
          </div>
        </Card>

        <Card>
          <div class="text-xs font-medium uppercase tracking-wide text-[rgb(var(--muted))]">
            Basal metabolic rate (BMR)
          </div>
          <div class="mt-1 text-[18px] font-semibold tracking-tight" id="bmr">—</div>
          <div class="mt-1 text-xs text-[rgb(var(--muted))]">
            Estimated calories per day your body needs at rest
          </div>
        </Card>
      </div>
    </section>

    <!-- Divider -->
    <hr class="border-t border-[rgb(var(--border))]" />

    <!-- How this calculator works (accordion, SF-style leading chevron) -->
    <section class="max-w-2xl" aria-label="How this calculator works">
      <details class="group">
        <summary
          class="flex cursor-pointer list-none items-center gap-2 py-2 text-sm font-semibold tracking-tight focus:outline-none focus-visible:ring-2 focus-visible:ring-black/20 rounded-lg"
        >
          <span
            class="inline-flex h-4 w-4 items-center justify-center text-[rgb(var(--muted))] transition-transform group-open:rotate-90"
            aria-hidden="true"
          >
            <svg
              viewBox="0 0 20 20"
              width="16"
              height="16"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M7.25 4.75L12.75 10L7.25 15.25"
                stroke="currentColor"
                stroke-width="1.75"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
          </span>

          <span>How this calculator works</span>
        </summary>

        <div class="pt-2 pl-6 space-y-2 text-sm text-[rgb(var(--muted))]">
          <p>
            We estimate your basal metabolic rate (BMR) using a standard formula based on age, height, weight and sex.
            We then apply an activity multiplier to estimate daily calories for maintenance at your selected activity level.
          </p>
          <p>
            This is a general estimate. Individual calorie needs vary due to factors such as body composition, metabolism and lifestyle.
          </p>
          <p>
            This calculator provides a general estimate and should not be used as medical or nutritional advice.
          </p>
        </div>
      </details>
    </section>

    <section class="max-w-2xl space-y-6" aria-label="Daily calorie needs guide">
      <div>
        <h2 class="text-[18px] font-semibold tracking-tight">What this calculator does</h2>
        <p class="mt-2 text-sm text-[rgb(var(--muted))]">
          This daily calorie needs calculator estimates how many calories you need to maintain your current weight. It
          uses your age, height, weight, sex, and activity level to estimate your basal metabolic rate (BMR) and then
          applies an activity multiplier.
        </p>
        <p class="mt-2 text-sm text-[rgb(var(--muted))]">
          The result is a maintenance estimate. If your goal is weight loss or gain, you would typically adjust the
          calories up or down from this baseline.
        </p>
      </div>

      <div>
        <h2 class="text-[18px] font-semibold tracking-tight">How the formula works</h2>
        <p class="mt-2 text-sm text-[rgb(var(--muted))]">
          We first estimate your BMR using a standard equation that considers sex, age, height, and weight. That gives
          an estimate of calories your body burns at rest. We then multiply BMR by an activity factor to estimate total
          daily energy expenditure (TDEE).
        </p>
        <p class="mt-2 text-sm text-[rgb(var(--muted))]">
          Activity level makes a big difference. A sedentary multiplier keeps calories close to BMR, while very active
          lifestyles push the estimate higher.
        </p>
      </div>

      <div>
        <h2 class="text-[18px] font-semibold tracking-tight">Worked example</h2>
        <p class="mt-2 text-sm text-[rgb(var(--muted))]">
          Example: a 34-year-old female, 165 cm, 65 kg, moderately active. The calculator estimates a BMR around 1,380
          kcal and a maintenance level around 2,140 kcal per day.
        </p>
        <p class="mt-2 text-sm text-[rgb(var(--muted))]">
          If activity drops to light, the estimate falls to around 1,900 kcal. Small changes in activity can shift the
          result by a few hundred calories.
        </p>
      </div>

      <div>
        <h2 class="text-[18px] font-semibold tracking-tight">Common mistakes</h2>
        <ul class="mt-2 list-disc pl-5 text-sm text-[rgb(var(--muted))] space-y-1">
          <li>Picking an activity level that is too high.</li>
          <li>Using height in metres instead of centimetres.</li>
          <li>Forgetting that calorie needs change with age.</li>
          <li>Assuming this is a precise medical calculation.</li>
        </ul>
      </div>

      <div>
        <h2 class="text-[18px] font-semibold tracking-tight">When to use this calculator</h2>
        <p class="mt-2 text-sm text-[rgb(var(--muted))]">
          Use this when you want a quick maintenance estimate for planning meals, training, or general health. If you
          want to lose or gain weight, use the result as a starting point and adjust slowly based on real progress.
        </p>
      </div>

      <div>
        <h2 class="text-[18px] font-semibold tracking-tight">FAQs</h2>
        <div class="mt-2 space-y-3 text-sm text-[rgb(var(--muted))]">
          <div>
            <h3 class="font-semibold text-[rgb(var(--text))]">Is this the same as BMI?</h3>
            <p class="mt-1">
              No. BMI is a weight-to-height ratio. This calculator estimates daily calories.
            </p>
          </div>
          <div>
            <h3 class="font-semibold text-[rgb(var(--text))]">What if I do strength training?</h3>
            <p class="mt-1">
              Choose the activity level that best reflects your overall week. If you train frequently, moderate or very
              active may be more appropriate.
            </p>
          </div>
          <div>
            <h3 class="font-semibold text-[rgb(var(--text))]">Can I use this during pregnancy?</h3>
            <p class="mt-1">
              This is a general estimate and not medical advice. Speak to a healthcare professional for tailored
              guidance.
            </p>
          </div>
        </div>
      </div>

      <div>
        <h2 class="text-[18px] font-semibold tracking-tight">Related calculators</h2>
        <ul class="mt-2 list-disc pl-5 text-sm text-[rgb(var(--muted))] space-y-1">
          <li><a class="underline" href="/calculators/weight-converter">Weight converter</a></li>
          <li><a class="underline" href="/calculators/height-converter">Height converter</a></li>
          <li><a class="underline" href="/calculators/percentage-calculator">Percentage calculator</a></li>
        </ul>
      </div>
    </section>
  </div>

  <script is:inline>
    const fmtKcal = new Intl.NumberFormat("en-GB", { maximumFractionDigits: 0 });

    const ACTIVITY = {
      sedentary: 1.2,
      light: 1.375,
      moderate: 1.55,
      very: 1.725,
    };

    const fields = {
      age: document.getElementById("age"),
      sex: document.getElementById("sex"),
      height: document.getElementById("height"),
      weight: document.getElementById("weight"),
      activity: document.getElementById("activity"),
    };

    const errors = {
      age: document.getElementById("age-error"),
      sex: document.getElementById("sex-error"),
      height: document.getElementById("height-error"),
      weight: document.getElementById("weight-error"),
      activity: document.getElementById("activity-error"),
    };

    function setBlankResults() {
      document.getElementById("tdee").textContent = "—";
      document.getElementById("bmr").textContent = "—";
    }

    function showError(key, msg) {
      const el = fields[key];
      const err = errors[key];
      if (!el || !err) return;

      el.setAttribute("aria-invalid", "true");
      el.setAttribute("aria-describedby", `${key}-error`);
      el.classList.add("border-red-500");

      err.textContent = msg;
      err.classList.remove("hidden");
    }

    function clearError(key) {
      const el = fields[key];
      const err = errors[key];
      if (!el || !err) return;

      el.removeAttribute("aria-invalid");
      if (el.getAttribute("aria-describedby") === `${key}-error`) el.removeAttribute("aria-describedby");
      el.classList.remove("border-red-500");

      err.textContent = "";
      err.classList.add("hidden");
    }

    function parseNumber(el) {
      const v = String(el?.value ?? "").trim();
      if (v === "") return null;
      const n = Number(v);
      return Number.isFinite(n) ? n : null;
    }

    function validate() {
      let firstInvalid = null;
      ["age", "sex", "height", "weight", "activity"].forEach(clearError);

      const age = parseNumber(fields.age);
      const height = parseNumber(fields.height);
      const weight = parseNumber(fields.weight);
      const sex = String(fields.sex?.value ?? "");
      const activityKey = String(fields.activity?.value ?? "");

      if (age === null) {
        showError("age", "Enter your age.");
        firstInvalid ??= fields.age;
      } else if (age < 13 || age > 120 || !Number.isInteger(age)) {
        showError("age", "Enter an age between 13 and 120.");
        firstInvalid ??= fields.age;
      }

      if (!sex) {
        showError("sex", "Select male or female.");
        firstInvalid ??= fields.sex;
      } else if (sex !== "male" && sex !== "female") {
        showError("sex", "Select a valid option.");
        firstInvalid ??= fields.sex;
      }

      if (height === null) {
        showError("height", "Enter your height in cm.");
        firstInvalid ??= fields.height;
      } else if (height < 120 || height > 230) {
        showError("height", "Enter a height between 120 and 230 cm.");
        firstInvalid ??= fields.height;
      }

      if (weight === null) {
        showError("weight", "Enter your weight in kg.");
        firstInvalid ??= fields.weight;
      } else if (weight < 30 || weight > 300) {
        showError("weight", "Enter a weight between 30 and 300 kg.");
        firstInvalid ??= fields.weight;
      }

      if (!activityKey) {
        showError("activity", "Select an activity level.");
        firstInvalid ??= fields.activity;
      } else if (!(activityKey in ACTIVITY)) {
        showError("activity", "Select a valid activity level.");
        firstInvalid ??= fields.activity;
      }

      return { valid: !firstInvalid, firstInvalid, age, height, weight, sex, activityKey };
    }

    // Mifflin–St Jeor (kcal/day)
    function calcBMR({ sex, weightKg, heightCm, ageYears }) {
      const base = 10 * weightKg + 6.25 * heightCm - 5 * ageYears;
      return sex === "male" ? base + 5 : base - 161;
    }

    function formatKcal(n) {
      return `${fmtKcal.format(Math.round(n))} kcal`;
    }

    function calculate() {
      const v = validate();
      if (!v.valid) {
        setBlankResults();
        v.firstInvalid?.focus();
        return;
      }

      const bmr = calcBMR({
        sex: v.sex,
        weightKg: v.weight,
        heightCm: v.height,
        ageYears: v.age,
      });

      const tdee = bmr * ACTIVITY[v.activityKey];

      document.getElementById("bmr").textContent = formatKcal(bmr);
      document.getElementById("tdee").textContent = formatKcal(tdee);
    }

    function reset() {
      fields.age.value = "";
      fields.sex.value = "";
      fields.height.value = "";
      fields.weight.value = "";
      fields.activity.value = "";

      ["age", "sex", "height", "weight", "activity"].forEach(clearError);
      setBlankResults();
      fields.age?.focus();
    }

    ["age", "height", "weight"].forEach((k) => fields[k]?.addEventListener("input", () => clearError(k)));
    ["sex", "activity"].forEach((k) => fields[k]?.addEventListener("change", () => clearError(k)));

    const calcBtn = document.getElementById("calcBtn");
    const calcLabel = calcBtn?.querySelector("[data-calc-label]");
    const calcSpinner = calcBtn?.querySelector("[data-calc-spinner]");

    function setLoading(isLoading) {
      if (!calcBtn) return;
      calcBtn.disabled = isLoading;
      calcBtn.setAttribute("aria-busy", isLoading ? "true" : "false");
      calcBtn.classList.toggle("opacity-70", isLoading);
      calcBtn.classList.toggle("cursor-not-allowed", isLoading);
      calcSpinner?.classList.toggle("hidden", !isLoading);
      calcLabel?.classList.toggle("sr-only", isLoading);
    }

    calcBtn?.addEventListener("click", () => {
      if (calcBtn.disabled) return;
      setLoading(true);
      window.setTimeout(() => {
        calculate();
        setLoading(false);
      }, 1000);
    });
    document.getElementById("resetBtn")?.addEventListener("click", reset);

    setBlankResults();
  </script>
</Layout>
