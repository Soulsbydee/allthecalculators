---
import Layout from "../../../layouts/Layout.astro";
import Card from "../../../components/Card.astro";
import Input from "../../../components/Input.astro";
import Button from "../../../components/Button.astro";

const title = "Savings growth calculator (UK) — All The Calculators";
const description =
  "Estimate how your savings could grow over time based on an initial balance, monthly contributions and interest rate.";
---

<Layout title={title} description={description}>
  <div class="space-y-6">
    <div>
      <h1 class="text-2xl font-semibold tracking-tight">Savings growth</h1>
      <p class="mt-2 text-sm text-[rgb(var(--muted))]">
        Enter how much you have now and how much you’ll save each month to estimate how your balance could grow.
      </p>
    </div>

    <!-- Inputs -->
    <section class="inputs-container space-y-4" aria-label="Savings growth inputs">
      <div class="inputs-grid">
        <div>
          <Input
            id="start"
            label="Starting balance (£)"
            type="number"
            inputmode="decimal"
            min="0"
            step="0.01"
            placeholder="e.g. 2,000"
          />
          <p id="start-error" class="mt-1 hidden text-xs text-red-600"></p>
        </div>

        <div>
          <Input
            id="monthly"
            label="Monthly contribution (£)"
            type="number"
            inputmode="decimal"
            min="0"
            step="0.01"
            placeholder="e.g. 200"
          />
          <p id="monthly-error" class="mt-1 hidden text-xs text-red-600"></p>
        </div>

        <div>
          <Input
            id="rate"
            label="Interest rate (%)"
            type="number"
            inputmode="decimal"
            min="0"
            step="0.01"
            placeholder="e.g. 4.0"
          />
          <p id="rate-error" class="mt-1 hidden text-xs text-red-600"></p>
        </div>

        <div>
          <Input
            id="years"
            label="Time period (years)"
            type="number"
            inputmode="numeric"
            min="1"
            step="1"
            placeholder="e.g. 5"
          />
          <p id="years-error" class="mt-1 hidden text-xs text-red-600"></p>
        </div>
      </div>

      <div class="flex flex-wrap gap-3 pt-1">
        <Button type="button" id="calcBtn">Calculate</Button>
        <Button type="button" variant="ghost" id="resetBtn">Reset</Button>
      </div>

      <p class="text-xs text-[rgb(var(--muted))]">
        This estimate assumes monthly contributions and a fixed annual interest rate.
      </p>
    </section>

    <!-- Divider -->
    <hr class="border-t border-[rgb(var(--border))]" />

    <!-- Results (NO tinted wrapper) -->
    <section aria-label="Savings growth results" class="space-y-4">
      <header>
        <h2 class="text-[18px] font-semibold tracking-tight">Results</h2>
        <p class="mt-1 text-[14px] text-[rgb(var(--muted))]">
          These are estimates based on your inputs.
        </p>
      </header>

      <div class="results-grid" role="status" aria-live="polite" aria-atomic="true">
        <Card>
          <div class="text-xs font-medium uppercase tracking-wide text-[rgb(var(--muted))]">
            Final balance
          </div>
          <div class="mt-1 text-[18px] font-semibold tracking-tight" id="final">—</div>
          <div class="mt-1 text-xs text-[rgb(var(--muted))]">
            Estimated balance after the time period
          </div>
        </Card>

        <Card>
          <div class="text-xs font-medium uppercase tracking-wide text-[rgb(var(--muted))]">
            Total contributed
          </div>
          <div class="mt-1 text-[18px] font-semibold tracking-tight" id="contrib">—</div>
          <div class="mt-1 text-xs text-[rgb(var(--muted))]">
            Starting balance + contributions
          </div>
        </Card>

        <Card>
          <div class="text-xs font-medium uppercase tracking-wide text-[rgb(var(--muted))]">
            Interest earned
          </div>
          <div class="mt-1 text-[18px] font-semibold tracking-tight" id="interest">—</div>
          <div class="mt-1 text-xs text-[rgb(var(--muted))]">
            Growth from interest
          </div>
        </Card>
      </div>
    </section>

    <!-- Divider -->
    <hr class="border-t border-[rgb(var(--border))]" />

    <!-- How it works (accordion, SF-style SVG chevron on left) -->
    <section class="max-w-2xl" aria-label="How this calculator works">
      <details class="group">
        <summary
          class="flex cursor-pointer list-none items-center gap-2 py-2 text-sm font-semibold tracking-tight focus:outline-none focus-visible:ring-2 focus-visible:ring-black/20 rounded-lg"
        >
          <span
            class="inline-flex h-4 w-4 items-center justify-center text-[rgb(var(--muted))] transition-transform group-open:rotate-90"
            aria-hidden="true"
          >
            <svg
              viewBox="0 0 20 20"
              width="16"
              height="16"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M7.25 4.75L12.75 10L7.25 15.25"
                stroke="currentColor"
                stroke-width="1.75"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
          </span>

          <span>How this calculator works</span>
        </summary>

        <div class="pt-2 pl-6 text-sm text-[rgb(var(--muted))]">
          <p>
            We apply a fixed monthly interest rate derived from the annual rate and add your monthly contribution.
            Results are estimates and real returns may vary.
          </p>
        </div>
      </details>
    </section>

    <section class="max-w-2xl space-y-6" aria-label="Savings growth guide">
      <div>
        <h2 class="text-[18px] font-semibold tracking-tight">What this calculator does</h2>
        <p class="mt-2 text-sm text-[rgb(var(--muted))]">
          This savings growth calculator estimates how your balance could grow over time when you add a fixed monthly
          contribution and earn interest. It helps you see the combined effect of saving regularly and compound growth.
        </p>
        <p class="mt-2 text-sm text-[rgb(var(--muted))]">
          Use it for planning longer-term goals like an emergency fund, a home deposit, or a large purchase where you
          want to understand the end balance rather than the monthly target.
        </p>
      </div>

      <div>
        <h2 class="text-[18px] font-semibold tracking-tight">How the formula works</h2>
        <p class="mt-2 text-sm text-[rgb(var(--muted))]">
          We convert your annual interest rate into a monthly rate and apply it to your balance each month. Your monthly
          contribution is added after interest is applied, then repeated for the total number of months.
        </p>
        <p class="mt-2 text-sm text-[rgb(var(--muted))]">
          The calculator also splits the final total into money you contributed and interest earned so you can see how
          much growth came from interest alone.
        </p>
      </div>

      <div>
        <h2 class="text-[18px] font-semibold tracking-tight">Worked example</h2>
        <p class="mt-2 text-sm text-[rgb(var(--muted))]">
          Example: you start with £2,000, add £200 per month, earn 4% interest, and save for 5 years. That gives 60 months
          of contributions. The estimate shows a final balance around £16,500, with the rest coming from interest.
        </p>
        <p class="mt-2 text-sm text-[rgb(var(--muted))]">
          If you raise the monthly contribution or extend the time period, the final balance increases significantly
          because interest compounds on a larger base.
        </p>
      </div>

      <div>
        <h2 class="text-[18px] font-semibold tracking-tight">Common mistakes</h2>
        <ul class="mt-2 list-disc pl-5 text-sm text-[rgb(var(--muted))] space-y-1">
          <li>Using a promotional rate that only applies for a short period.</li>
          <li>Forgetting to update the contribution amount when your budget changes.</li>
          <li>Mixing up monthly and annual rates.</li>
          <li>Assuming the result is guaranteed rather than an estimate.</li>
        </ul>
      </div>

      <div>
        <h2 class="text-[18px] font-semibold tracking-tight">When to use this calculator</h2>
        <p class="mt-2 text-sm text-[rgb(var(--muted))]">
          Use this when you already know how much you can save each month and want to estimate your end balance. If you
          instead have a target amount and deadline, use the Savings goal calculator to back-calculate the monthly amount.
        </p>
      </div>

      <div>
        <h2 class="text-[18px] font-semibold tracking-tight">FAQs</h2>
        <div class="mt-2 space-y-3 text-sm text-[rgb(var(--muted))]">
          <div>
            <h3 class="font-semibold text-[rgb(var(--text))]">Is this based on monthly or annual compounding?</h3>
            <p class="mt-1">
              The calculator assumes monthly compounding because contributions are monthly. If your account compounds
              annually, results will be slightly different.
            </p>
          </div>
          <div>
            <h3 class="font-semibold text-[rgb(var(--text))]">Can I include an annual bonus contribution?</h3>
            <p class="mt-1">
              This version assumes a fixed monthly amount. For bonuses or irregular payments, use the estimate as a
              baseline and adjust the monthly contribution upward.
            </p>
          </div>
          <div>
            <h3 class="font-semibold text-[rgb(var(--text))]">How do I choose the interest rate?</h3>
            <p class="mt-1">
              Use the AER of the account you plan to use. If you are unsure, choose a lower rate to reflect a conservative
              estimate.
            </p>
          </div>
        </div>
      </div>

      <div>
        <h2 class="text-[18px] font-semibold tracking-tight">Related calculators</h2>
        <ul class="mt-2 list-disc pl-5 text-sm text-[rgb(var(--muted))] space-y-1">
          <li><a class="underline" href="/calculators/savings-goal">Savings goal calculator</a></li>
          <li><a class="underline" href="/calculators/percentage-calculator">Percentage calculator</a></li>
          <li><a class="underline" href="/calculators/take-home-salary">Take home salary calculator</a></li>
        </ul>
      </div>
    </section>
  </div>

  <script is:inline>
    const fmtGBP2 = new Intl.NumberFormat("en-GB", { style: "currency", currency: "GBP" });

    const fields = {
      start: document.getElementById("start"),
      monthly: document.getElementById("monthly"),
      rate: document.getElementById("rate"),
      years: document.getElementById("years"),
    };

    const errors = {
      start: document.getElementById("start-error"),
      monthly: document.getElementById("monthly-error"),
      rate: document.getElementById("rate-error"),
      years: document.getElementById("years-error"),
    };

    function setBlankResults() {
      document.getElementById("final").textContent = "—";
      document.getElementById("contrib").textContent = "—";
      document.getElementById("interest").textContent = "—";
    }

    function showError(key, msg) {
      const input = fields[key];
      const err = errors[key];
      if (!input || !err) return;
      input.setAttribute("aria-invalid", "true");
      input.setAttribute("aria-describedby", `${key}-error`);
      input.classList.add("border-red-500");
      err.textContent = msg;
      err.classList.remove("hidden");
    }

    function clearError(key) {
      const input = fields[key];
      const err = errors[key];
      if (!input || !err) return;
      input.removeAttribute("aria-invalid");
      if (input.getAttribute("aria-describedby") === `${key}-error`) input.removeAttribute("aria-describedby");
      input.classList.remove("border-red-500");
      err.textContent = "";
      err.classList.add("hidden");
    }

    function parseNumber(el) {
      const v = String(el?.value ?? "").trim();
      if (v === "") return null;
      const n = Number(v);
      return Number.isFinite(n) ? n : null;
    }

    function validate() {
      ["start","monthly","rate","years"].forEach(clearError);
      let firstInvalid = null;

      const start = parseNumber(fields.start);
      const monthly = parseNumber(fields.monthly);
      const rate = parseNumber(fields.rate);
      const years = parseNumber(fields.years);

      if (start === null || start < 0) {
        showError("start", "Enter a starting balance (0 or more).");
        firstInvalid ??= fields.start;
      }
      if (monthly === null || monthly < 0) {
        showError("monthly", "Enter a monthly contribution (0 or more).");
        firstInvalid ??= fields.monthly;
      }
      if (rate === null || rate < 0 || rate > 200) {
        showError("rate", "Enter an interest rate between 0 and 200%.");
        firstInvalid ??= fields.rate;
      }
      if (years === null || years <= 0 || !Number.isInteger(years)) {
        showError("years", "Enter a time period in whole years (at least 1).");
        firstInvalid ??= fields.years;
      }

      return { valid: !firstInvalid, firstInvalid, start, monthly, rate, years };
    }

    function calculate() {
      const v = validate();
      if (!v.valid) {
        setBlankResults();
        v.firstInvalid?.focus();
        return;
      }

      const months = v.years * 12;
      const r = (v.rate / 100) / 12;

      let balance = v.start;
      let contributions = v.start;

      for (let i = 0; i < months; i++) {
        balance = balance * (1 + r) + v.monthly;
        contributions += v.monthly;
      }

      const interest = balance - contributions;

      document.getElementById("final").textContent = fmtGBP2.format(balance);
      document.getElementById("contrib").textContent = fmtGBP2.format(contributions);
      document.getElementById("interest").textContent = fmtGBP2.format(interest);
    }

    function reset() {
      ["start","monthly","rate","years"].forEach((k) => {
        fields[k].value = "";
        clearError(k);
      });
      setBlankResults();
      fields.start?.focus();
    }

    ["start","monthly","rate","years"].forEach((k) => fields[k]?.addEventListener("input", () => clearError(k)));

    const calcBtn = document.getElementById("calcBtn");
    const calcLabel = calcBtn?.querySelector("[data-calc-label]");
    const calcSpinner = calcBtn?.querySelector("[data-calc-spinner]");

    function setLoading(isLoading) {
      if (!calcBtn) return;
      calcBtn.disabled = isLoading;
      calcBtn.setAttribute("aria-busy", isLoading ? "true" : "false");
      calcBtn.classList.toggle("opacity-70", isLoading);
      calcBtn.classList.toggle("cursor-not-allowed", isLoading);
      calcSpinner?.classList.toggle("hidden", !isLoading);
      calcLabel?.classList.toggle("sr-only", isLoading);
    }

    calcBtn?.addEventListener("click", () => {
      if (calcBtn.disabled) return;
      setLoading(true);
      window.setTimeout(() => {
        calculate();
        setLoading(false);
      }, 1000);
    });
    document.getElementById("resetBtn")?.addEventListener("click", reset);

    setBlankResults();
  </script>
</Layout>
